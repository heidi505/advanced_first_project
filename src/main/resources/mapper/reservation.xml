<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
        namespace="com.tenco.team_two_flight_ticket.reservation.ReservationRepository">
    <select id="getMyTravel" resultType="com.tenco.team_two_flight_ticket.user.UserResponse$GetMyTravelDTO">
        select r.id as id, is_payed, user_id, r.created_at as created_at, payment_deadline
        , reservation_num, status_enum, airline, arrival_city, departure_airport, departure_city
        , flight_name, departure_time, arrival_time
        from reservation_tb as r
        join ticket_tb as t
        on r.id = t.reservation_id
        where user_id = #{userId}
        and status_enum = #{statusEnum}
        <if test="sort == 'true'">
            and is_payed = 'true'
        </if>
        <if test="sort == 'false'">
            and is_payed = 'false'
        </if>
        order by departure_time
    </select>

    <select id="getMyTripCount" resultType="int">
        select count(*)
        from reservation_tb as r
        join ticket_tb as t
        on r.id = t.reservation_id
        where user_id = #{userId}
        and status_enum = #{statusEnum}
        <if test="sort == 'true'">
            and is_payed = true
        </if>
        <if test="sort == 'false'">
            and is_payed = false
        </if>
    </select>

    <insert id="insertR">
        insert into reservation_tb(user_id, res_name, email, phone_num, reservation_num, status_enum, passenger_amount,
                                   payment_deadline, reservation_price, created_at)
        values (1, #{resName}, #{email}, #{phoneNum}, #{reservationNum}, '예정', 1, null, null, now())
    </insert>

    <insert id="insertP">
        insert into passenger_tb(reservation_id, first_name, last_name, birth_date, gender, passenger_type, created_at)
        values (#{reservationId}, #{firstName}, #{lastName}, #{birthDate}, #{gender}, null, now())
    </insert>

    <insert id="insertT">
        insert into ticket_tb(reservation_id, air_fare, fuel_surcharge, taxes, ticketing_fee, total_price, airline,
                              flight_name, departure_city, arrival_city, departure_time, arrival_time,
                              departure_airport, arrival_airport, seat_type, is_one_way, is_non_stop, baggage_allowance,
                              created_at)
        values (#{reservationId}, null, null, null, null, null, null, null, null, null, null, null, null, null, null, #{isOneWay}, #{isNonStop},
                #{baggageAllowance}, now())
    </insert>
</mapper>