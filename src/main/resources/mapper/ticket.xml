<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
        namespace="com.tenco.team_two_flight_ticket.ticket.TicketRepository">

    <select id="getCities" resultType="com.tenco.team_two_flight_ticket._middle._entity.City">
        select * from city_tb where country_name = #{region}
    </select>
    <select id="findByTicketJoinReservation" resultType="com.tenco.team_two_flight_ticket.ticket.Ticket">
        SELECT departure_airport
        FROM TICKET_TB as tb
                 left join reservation_tb as rb
                           on tb.id = rb.id
                 left join user_tb as ub
                           on ub.id = tb.id
        where ub.id = #{userId};
    </select>

    <select id="getTicketDate" resultType="com.tenco.team_two_flight_ticket.ticket.TicketResponse$GetTicketDateDTO">
		select departure_time, dc.city_name as departure_city, ac.city_name as arrival_city, reservation_num
		from ticket_tb as t
		join reservation_tb as r
		on t.reservation_id = r.id
        join city_tb as dc
        on t.departure_city = dc.city_code
        join city_tb as ac
        on t.arrival_city = ac.city_code
		where status_enum = '예정'
		and r.user_id = #{userId}
        order by departure_time limit 1;
	</select>
    
</mapper>