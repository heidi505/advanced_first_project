<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
        namespace="com.tenco.team_two_flight_ticket.coupon.CouponRepository">
    <insert id="insert">
        insert into coupon_tb(coupon_name, coupon_period, discounting_price, coupon_content, coupon_number, is_used, created_at,
                              expired_at)
        values (#{couponName}, #{couponPeriod}, #{discountingPrice}, #{couponContent}, #{couponNumber}, #{isUsed}, #{createdAt},
                #{expiredAt})
    </insert>

    <select id="findAll" resultType="com.tenco.team_two_flight_ticket.coupon.dto.CouponListDTO">
        SELECT * FROM COUPON_TB as ct order by ct.id desc
    </select>

    <select id="findByUserId" resultType="com.tenco.team_two_flight_ticket.coupon.dto.CouponDetailDTO">
        SELECT *,
               CASE
                   WHEN is_used = true THEN '만료됨'
                   ELSE '만료안됨'
                   END AS expired
        FROM HASCOUPON_TB as ht
                 LEFT JOIN coupon_tb as ct ON ht.id = ct.id
                 LEFT JOIN user_tb as ut ON ht.id = ut.id
        WHERE user_id = #{userId}
        order by ct.id desc
    </select>


    <select id="findCouponExpiredAll" resultType="com.tenco.team_two_flight_ticket.coupon.dto.CouponExpiredListDTO">
        SELECT *,
               CASE
                   WHEN is_used = true THEN '만료됨'
                   ELSE '만료안됨'
                   END AS expired
        FROM COUPON_TB as ct
        where is_used = true
        order by ct.id desc
    </select>
</mapper>